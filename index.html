<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŸ‹ç‘ç•«å»Š v6.1</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 550px; margin-bottom: 15px; box-sizing: border-box; }
        h2, h3 { text-align: center; color: #2c3e50; margin-top: 0; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .section { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #34495e; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccd1d9; border-radius: 8px; box-sizing: border-box; font-size: 16px; background: #fff; }
        .row { display: flex; gap: 8px; align-items: center; }
        .unit-info { font-size: 14px; color: #2980b9; margin-top: 12px; background: #eef7ff; padding: 12px; border-radius: 8px; border: 1px solid #d6eaf8; line-height: 1.6; }
        .live-price-box { background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 2px dashed #e67e22; margin: 10px 0; }
        .live-price-val { font-size: 32px; font-weight: bold; color: #e67e22; }
        .warning-text { color: #e74c3c; font-weight: bold; font-size: 13px; margin-top: 5px; display: block; }
        .btn-add { background: #27ae60; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn-checkout { background: #2c3e50; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .option-group { background:#fff9f0; padding:12px; border-radius:10px; border: 1px solid #ffe0b2; margin-top: 10px; }
        .check-item { display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 8px; font-size: 14px; }
        .check-item input { width: auto; transform: scale(1.2); }
        .hidden { display: none !important; }
        @media print { .no-print { display: none !important; } .card { box-shadow: none; border: none; width: 100%; } body { background: #fff; padding: 0; } }
    </style>
</head>
<body>

<div class="card no-print">
    <h2>éŸ‹ç‘ç•«å»Š v6.1</h2>
    <div class="section" style="background: #fcfcfc; border: 1px solid #eee; padding: 15px; border-radius: 10px;">
        <label>ğŸ‘¤ å®¢æˆ¶è³‡æ–™</label>
        <div class="row" style="margin-bottom: 10px;"><input type="text" id="cust_name" placeholder="å§“å"><input type="tel" id="cust_phone" placeholder="é›»è©±"></div>
        <div class="row">
            <div style="flex:1;"><label style="font-size:12px;">æ”¶ä»¶æ—¥æœŸ</label><input type="date" id="date_receive"></div>
            <div style="flex:1;"><label style="font-size:12px;">äº¤ä»¶æ—¥æœŸ</label><input type="date" id="date_deliver"></div>
        </div>
    </div>
</div>

<div class="card no-print" id="inputSection">
    <h3>ğŸ’° å ±åƒ¹è¨ˆç®—</h3>
    <div class="section">
        <label>å ±åƒ¹æ¨¡å¼</label>
        <select id="mode" onchange="toggleMode()">
            <option value="normal" selected>åœ‹ç•«è£æ¡† (å‘¨é•·è¨ˆåƒ¹)</option>
            <option value="oil">æ²¹ç•«è£æ¡† (å †ç–Šè¨ˆåƒ¹)</option>
            <option value="board">åœ‹ç•«è£±æ¿ (é¢ç©è¨ˆåƒ¹)</option>
            <option value="scroll">ç«‹è»¸æ›è»¸</option>
        </select>
    </div>

    <div class="row">
        <div style="flex:1;"><label>ç•«å¿ƒé•· (ä¸‰ä½æ•¸)</label><input type="number" id="L_in" oninput="runCalc()" inputmode="numeric" placeholder="å¦‚ 300"></div>
        <div style="flex:1;"><label>ç•«å¿ƒå¯¬ (ä¸‰ä½æ•¸)</label><input type="number" id="W_in" oninput="runCalc()" inputmode="numeric" placeholder="å¦‚ 600"></div>
    </div>
    <div class="row" style="margin-top:10px;">
        <div style="flex:1;"><label>é ç•™é•·é‚Š</label><input type="number" id="padL" value="100" oninput="runCalc()"></div>
        <div style="flex:1;"><label>é ç•™çŸ­é‚Š</label><input type="number" id="padW" value="50" oninput="runCalc()"></div>
    </div>

    <div id="normal-options" class="option-group">
        <label>é¸æ“‡æ¡†ç¨® (åŸºæ•¸)</label>
        <select id="baseRate" onchange="runCalc()">
            <option value="250">åœ‹ç•«æ¡† (250)</option>
            <option value="280">2å¯¸ç‰¹é¸æ‰‹å·¥æ¡† (280)</option>
            <option value="300">3å¯¸ç‰¹é¸æ‰‹å·¥æ¡† (300)</option>
            <option value="230">8åˆ†ç‰¹é¸æ‰‹å·¥æ¡† (230)</option>
            <option value="200">6åˆ†ç‰¹é¸æ‰‹å·¥æ¡† (200)</option>
        </select>
        <div class="check-item" style="margin-top:10px;"><input type="checkbox" id="addAcy" onchange="runCalc()"> åŠ å£“å…‹åŠ› (120/æ‰)</div>
    </div>

    <div id="oil-options" class="option-group hidden">
        <label>æ²¹ç•«æ–½ä½œæ–¹å¼</label>
        <select id="oilType" onchange="runCalc()">
            <option value="direct">ç›´æ¥æ¡† (å–®ç´”æ¡†æ¢)</option>
            <option value="solid">ç«‹é«”æ¡† (åº•æ¿ + æ¡†æ¢)</option>
            <option value="inout">å…§å¤–æ¡† (åº•æ¿ + æ¡†æ¢ + å…§æ¡†)</option>
        </select>
        <label style="margin-top:10px;">å¤–æ¡†æ¢åŸºæ•¸</label>
        <select id="oilFrameBase" onchange="runCalc()">
            <option value="20">6åˆ†æ¡† (20)</option>
            <option value="25">å¯¸åŠæ¡† (25)</option>
            <option value="35">å…©å¯¸åŠæ¡† (35)</option>
            <option value="45">ä¸‰å¯¸æ¡† (45)</option>
        </select>
        <div class="check-item" style="margin-top:10px;"><input type="checkbox" id="oilCloth" onchange="runCalc()"> åŠ å¸ƒå…§æ¡† (é•·+å¯¬ x 12)</div>
        <div class="check-item"><input type="checkbox" id="oilAcy" onchange="runCalc()"> åŠ å£“å…‹åŠ› (80/æ‰)</div>
        <div class="check-item"><input type="checkbox" id="oilProtect" onchange="runCalc()"> ç•«é¢ä¿è­· (80/æ‰)</div>
        <div class="row" style="margin-top:5px;"><label style="font-size:12px;width:100px;">ä¿®å¾©è²»(æ‰‹å¡«)</label><input type="number" id="oilRepair" placeholder="0" oninput="runCalc()"></div>
    </div>

    <div id="board-options" class="option-group hidden">
        <label>åŠ è³¼ Lå‹æ¡†</label>
        <select id="lFrameType" onchange="runCalc()">
            <option value="0">ç„¡åŠ æ¡†</option>
            <option value="12">Lå‹æ¡† - ä¾¿æ¡† (12)</option>
            <option value="25">Lå‹æ¡† - æ‰‹å·¥æ¡† (25)</option>
        </select>
    </div>

    <div id="scroll-options" class="option-group hidden">
        <label>ç«‹è»¸è¦æ ¼</label>
        <select id="scrollSize" onchange="runCalc()">
            <option value="1000">å°å°é–‹ (1000)</option>
            <option value="900">å°é–‹ (900)</option>
            <option value="1300">ä¸‰é–‹ (1300)</option>
            <option value="1500">å…¨é–‹ (1500)</option>
            <option value="3500">å¤§å…¨é–‹ (3500)</option>
        </select>
    </div>

    <div class="live-price-box">
        <div class="live-price-val">NT$ <span id="priceTxt">0</span></div>
        <div id="sizeDetail" class="unit-info"></div>
        <span id="liveWarning" class="warning-text"></span>
    </div>
    <button class="btn-add" onclick="addItem()">ï¼‹ åŠ å…¥å ±åƒ¹æ¸…å–®</button>
</div>

<div class="card" id="cartSection">
    <h3>ğŸ“ å ±åƒ¹å–®æ¸…å–®</h3>
    <div id="printHeader" class="hidden" style="border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:10px; font-size:14px;"></div>
    <table style="width:100%;" id="cartTable"></table>
    <div style="text-align:right; font-size:22px; font-weight:bold; color:#c0392b; margin-top:15px; border-top:2px solid #2c3e50; padding-top:10px;">
        ç¸½è¨ˆé‡‘é¡ï¼šNT$ <span id="totalTxt">0</span>
    </div>
    <div class="no-print">
        <button id="finalBtn" class="btn-checkout" onclick="processCheckout()">ç¢ºèªçµå–®</button>
        <button id="resetBtn" class="btn-checkout hidden" style="background:#f39c12;" onclick="location.reload()">ä¸‹ä¸€å¼µæ–°è¨‚å–®</button>
        <button class="btn-checkout" style="background:#3498db;" onclick="window.print()">åˆ—å°å–®æ“š</button>
    </div>
</div>

<script>
    const TAI_TO_CM = 30.3;
    const TAI_TO_INCH = 11.93;
    let cart = [];
    let currentPrice = 0;

    function runCalc() {
        const mode = document.getElementById('mode').value;
        const L = (parseFloat(document.getElementById('L_in').value) || 0) / 100;
        const W = (parseFloat(document.getElementById('W_in').value) || 0) / 100;
        const pL = (parseFloat(document.getElementById('padL').value) || 0) / 100;
        const pW = (parseFloat(document.getElementById('padW').value) || 0) / 100;
        const warningEl = document.getElementById('liveWarning');
        warningEl.innerText = "";
        
        if (L <= 0 || W <= 0) { currentPrice = 0; document.getElementById('priceTxt').innerText="0"; return; }

        const tL = L + pL; const tW = W + pW;
        const Lcm = tL * TAI_TO_CM; const Wcm = tW * TAI_TO_CM;
        const Linch = tL * TAI_TO_INCH; const Winch = tW * TAI_TO_INCH;
        const cai = (Linch * Winch) / 144;
        
        // --- ä¿®æ­£å¾Œçš„è¶…å°ºå¯¸åˆ¤å®šé‚è¼¯ ---
        // é–€æª»ï¼š4å°º(121.2cm), 8å°º(242.4cm)
        const maxSide = Math.max(Lcm, Wcm);
        let multiplier = 1.0;
        let laborExtra = 0;

        if (maxSide > 242.4) {
            multiplier = 1.8; // è¶…é8å°º
            laborExtra = 5000;
            warningEl.innerText = "âš ï¸ é‚Šé•·è¶…é 8 å°ºï¼šç‰¹å¤§å‹ä»¶åŠ æˆå·²è¨ˆå…¥";
        } else if (maxSide > 121.2) {
            multiplier = 1.5; // è¶…é4å°º
            laborExtra = 3000;
            warningEl.innerText = "âš ï¸ é‚Šé•·è¶…é 4 å°ºï¼šå¤§å‹ä»¶åŠ æˆå·²è¨ˆå…¥";
        }

        document.getElementById('sizeDetail').innerText = `æ¡†å…§ï¼š${Lcm.toFixed(1)}x${Wcm.toFixed(1)} cm (${tL.toFixed(2)}x${tW.toFixed(2)} å°º)`;

        if (mode === 'normal') {
            const base = parseInt(document.getElementById('baseRate').value);
            currentPrice = Math.round((tL + tW) * base * multiplier + laborExtra);
            if(document.getElementById('addAcy').checked) currentPrice += Math.round(tL * tW * (multiplier > 1 ? 120 : 80));
        } 
        else if (mode === 'oil') {
            const type = document.getElementById('oilType').value;
            const base = parseInt(document.getElementById('oilFrameBase').value);
            let baseP = (type === 'direct') ? 0 : Math.round(cai * 50);
            let frameP = Math.round((Linch + Winch) * base * multiplier);
            let inP = (type === 'inout') ? Math.round((Linch + Winch) * 12) : 0;
            currentPrice = baseP + frameP + inP;
            if(document.getElementById('oilCloth').checked) currentPrice += Math.round((Linch + Winch) * 12);
            if(document.getElementById('oilAcy').checked) currentPrice += Math.round(cai * 80);
            if(document.getElementById('oilProtect').checked) currentPrice += Math.round(cai * 80);
            currentPrice += (parseFloat(document.getElementById('oilRepair').value) || 0);
        }
        else if (mode === 'board') {
            const lRate = parseInt(document.getElementById('lFrameType').value);
            currentPrice = Math.round(cai * 80) + Math.round((Linch + Winch) * lRate);
        }
        else {
            currentPrice = parseInt(document.getElementById('scrollSize').value);
        }

        if(currentPrice < 350) currentPrice = 350;
        document.getElementById('priceTxt').innerText = currentPrice.toLocaleString();
    }

    function toggleMode() {
        const m = document.getElementById('mode').value;
        document.getElementById('normal-options').classList.toggle('hidden', m !== 'normal');
        document.getElementById('oil-options').classList.toggle('hidden', m !== 'oil');
        document.getElementById('board-options').classList.toggle('hidden', m !== 'board');
        document.getElementById('scroll-options').classList.toggle('hidden', m !== 'scroll');
        runCalc();
    }

    function addItem() {
        if(currentPrice <= 0) return alert("å°ºå¯¸ä¸æ­£ç¢º");
        const mName = document.getElementById('mode').options[document.getElementById('mode').selectedIndex].text;
        cart.push({ title: mName, price: currentPrice, spec: document.getElementById('sizeDetail').innerText });
        renderCart();
    }

    function renderCart() {
        const table = document.getElementById('cartTable'); table.innerHTML = ""; let total = 0;
        cart.forEach((it, idx) => {
            total += it.price;
            table.innerHTML += `<tr><td style="padding:10px; border-bottom:1px solid #eee;"><b>${it.title}</b><br><small>${it.spec}</small></td><td align="right">${it.price.toLocaleString()}</td><td align="right" class="no-print"><button onclick="cart.splice(${idx},1);renderCart()" style="color:red; background:none; border:none; cursor:pointer;">âŒ</button></td></tr>`;
        });
        document.getElementById('totalTxt').innerText = total.toLocaleString();
    }

    function processCheckout() {
        if(cart.length === 0) return alert("å°šæœªåŠ å…¥ä»»ä½•é …ç›®");
        const name = document.getElementById('cust_name').value || "æœªå¡«å¯«";
        const phone = document.getElementById('cust_phone').value || "æœªå¡«å¯«";
        const dR = document.getElementById('date_receive').value;
        const dD = document.getElementById('date_deliver').value;
        document.getElementById('printHeader').innerHTML = `<b>å®¢æˆ¶å§“åï¼š</b>${name} | <b>é›»è©±ï¼š</b>${phone}<br><b>æ”¶ä»¶ï¼š</b>${dR} | <b>äº¤ä»¶ï¼š</b>${dD}`;
        document.getElementById('printHeader').classList.remove('hidden');
        document.getElementById('finalBtn').classList.add('hidden');
        document.getElementById('resetBtn').classList.remove('hidden');
        window.scrollTo(0,0);
    }

    window.onload = function() {
        const d = new Date(); document.getElementById('date_receive').value = d.toISOString().split('T')[0];
        const n = new Date(); n.setDate(d.getDate() + 14); document.getElementById('date_deliver').value = n.toISOString().split('T')[0];
        runCalc();
    };
</script>
</body>
</html>
