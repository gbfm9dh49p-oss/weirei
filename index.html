<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŸ‹ç‘ç•«å»Š v6.0</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 550px; margin-bottom: 15px; box-sizing: border-box; }
        h2, h3 { text-align: center; color: #2c3e50; margin-top: 0; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .section { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #34495e; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccd1d9; border-radius: 8px; box-sizing: border-box; font-size: 16px; background-color: #fff; }
        .row { display: flex; gap: 8px; align-items: center; }
        .unit-info { font-size: 14px; color: #2980b9; margin-top: 12px; background: #eef7ff; padding: 12px; border-radius: 8px; border: 1px solid #d6eaf8; line-height: 1.6; }
        .live-price-box { background: #fff; padding: 15px; border-radius: 10px; text-align: center; margin: 15px 0; border: 2px dashed #e67e22; }
        .live-price-val { font-size: 32px; font-weight: bold; color: #e67e22; }
        .warning-text { color: #e74c3c; font-weight: bold; font-size: 12px; display: block; margin-top: 5px; }
        .btn-add { background-color: #27ae60; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn-checkout { background-color: #2c3e50; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .cart-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        .cart-total { text-align: right; font-size: 22px; font-weight: bold; color: #c0392b; margin-top: 15px; padding: 10px; border-top: 2px solid #2c3e50; }
        .hidden { display: none !important; }
        .option-group { background:#fff9f0; padding:12px; border-radius:10px; border: 1px solid #ffe0b2; margin-top: 10px; }
        .check-item { display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 8px; font-size: 14px; }
        .check-item input { width: auto; transform: scale(1.2); }
        @media print { .no-print { display: none !important; } .card { box-shadow: none; border: none; width: 100%; } body { background: #fff; padding: 0; } }
    </style>
</head>
<body>

<div class="card no-print" id="inputSection">
    <h2>éŸ‹ç‘ç•«å»Š v6.0</h2>

    <div class="section" style="background: #fcfcfc; border: 1px solid #eee; padding: 15px; border-radius: 10px;">
        <label>ğŸ‘¤ å®¢æˆ¶è³‡æ–™</label>
        <div class="row" style="margin-bottom: 8px;"><input type="text" id="cust_name" placeholder="å§“å"><input type="tel" id="cust_phone" placeholder="é›»è©±"></div>
        <div class="row">
            <div><label style="font-size: 11px;">æ”¶ä»¶æ—¥</label><input type="date" id="date_receive"></div>
            <div><label style="font-size: 11px;">äº¤ä»¶æ—¥</label><input type="date" id="date_deliver"></div>
        </div>
    </div>

    <div class="section">
        <label>å ±åƒ¹æ¨¡å¼</label>
        <select id="mode" onchange="toggleMode()">
            <option value="normal">åœ‹ç•«è£æ¡† (å‘¨é•·è¨ˆåƒ¹)</option>
            <option value="oil" selected>æ²¹ç•«è£æ¡† (å †ç–Šè¨ˆåƒ¹)</option>
            <option value="board">åœ‹ç•«è£±æ¿ (é¢ç©è¨ˆåƒ¹)</option>
            <option value="scroll">ç«‹è»¸æ›è»¸</option>
        </select>
    </div>

    <div id="size-inputs">
        <div class="row">
            <div class="section"><label>ç•«å¿ƒé•· (ä¸‰ä½æ•¸)</label><input type="number" id="L_input" placeholder="å¦‚ 300" oninput="calculateLive()" inputmode="numeric"></div>
            <div class="section"><label>ç•«å¿ƒå¯¬ (ä¸‰ä½æ•¸)</label><input type="number" id="W_input" placeholder="å¦‚ 600" oninput="calculateLive()" inputmode="numeric"></div>
        </div>
        <div class="row">
            <div class="section"><label>é ç•™é•·é‚Š</label><input type="number" id="padL_input" value="100" oninput="calculateLive()" inputmode="numeric"></div>
            <div class="section"><label>é ç•™çŸ­é‚Š</label><input type="number" id="padW_input" value="50" oninput="calculateLive()" inputmode="numeric"></div>
        </div>
    </div>

    <div id="oil-options" class="option-group">
        <label>æ²¹ç•«æ–½ä½œæ–¹å¼</label>
        <select id="oilType" onchange="calculateLive()">
            <option value="direct">ç›´æ¥æ¡† (å–®ç´”æ¡†æ¢)</option>
            <option value="solid">ç«‹é«”æ¡† (åº•æ¿ + æ¡†æ¢)</option>
            <option value="inout">å…§å¤–æ¡† (åº•æ¿ + æ¡†æ¢ + å…§æ¡†)</option>
        </select>
        
        <label style="margin-top:10px;">æ¡†æ¢é¸æ“‡ (åŸºæ•¸)</label>
        <select id="oilFrameBase" onchange="calculateLive()">
            <option value="20">6åˆ†æ¡† (20)</option>
            <option value="25">å¯¸åŠæ¡† (25)</option>
            <option value="35">å…©å¯¸åŠæ¡† (35)</option>
            <option value="45">ä¸‰å¯¸æ¡† (45)</option>
        </select>

        <label style="margin-top:10px;">é¸é…åŠ è³¼é …ç›®</label>
        <div class="check-item"><input type="checkbox" id="oilCloth" onchange="calculateLive()"> å¸ƒå…§æ¡† (é•·+å¯¬ Ã— 12)</div>
        <div class="check-item"><input type="checkbox" id="oilAcy" onchange="calculateLive()"> åŠ å£“å…‹åŠ› (80/æ‰)</div>
        <div class="check-item"><input type="checkbox" id="oilSwap" onchange="calculateLive()"> åŠ æ›¿æ›å¼è¨­å‚™ (50/æ‰)</div>
        <div class="check-item"><input type="checkbox" id="oilProtect" onchange="calculateLive()"> ç•«é¢ä¿è­· (80/æ‰)</div>
        <div class="row" style="margin-top:5px;"><label style="font-size:12px;width:80px">ç•«é¢ä¿®å¾©</label><input type="number" id="oilRepair" placeholder="è²»ç”¨æ‰‹å¡«" oninput="calculateLive()"></div>
    </div>

    <div id="normal-extra" style="display:none;">
        <label>é¸æ“‡æ¡†ç¨®</label>
        <select id="baseRate" onchange="calculateLive()">
            <option value="250">åœ‹ç•«æ¡† (250)</option>
            <option value="280">2å¯¸ç‰¹é¸æ‰‹å·¥æ¡† (280)</option>
            <option value="300">3å¯¸ç‰¹é¸æ‰‹å·¥æ¡† (300)</option>
        </select>
    </div>

    <div id="sizeDisplay" class="unit-info">
        <div><strong>å°ºå¯¸ï¼š</strong> <span id="innerL_txt">0</span>x<span id="innerW_txt">0</span> cm (<span id="innerTai_txt">0x0</span> å°º)</div>
        <div id="oilDetail" style="display:none; font-size:12px; color:#d35400; margin-top:5px;">æ›ç®—è‹±å‹ï¼š<span id="inch_txt">0</span>"</div>
    </div>

    <div class="live-price-box">
        <div class="live-price-val">NT$ <span id="liveTotal">0</span></div>
        <span id="liveWarning" class="warning-text"></span>
    </div>

    <button class="btn-add" onclick="addToCart()">ï¼‹ åŠ å…¥è¨‚å–®æ¸…å–®</button>
</div>

<div class="card" id="cartSection">
    <h3>è¨‚å–®å ±åƒ¹å–®</h3>
    <div id="printInfo" class="info-grid">
        <div class="info-item"><b>å®¢æˆ¶ï¼š</b><span id="p_name">---</span></div>
        <div class="info-item"><b>é›»è©±ï¼š</b><span id="p_phone">---</span></div>
        <div class="info-item"><b>æ”¶ä»¶æ—¥ï¼š</b><span id="p_dateR">---</span></div>
        <div class="info-item"><b>äº¤ä»¶æ—¥ï¼š</b><span id="p_dateD">---</span></div>
    </div>
    <table class="cart-table"><tbody id="cartItems"></tbody></table>
    <div class="cart-total">ç¸½è¨ˆé‡‘é¡ï¼šNT$ <span id="grandTotal">0</span></div>
    <div class="no-print">
        <button id="confirmBtn" class="btn-checkout" onclick="checkoutMode()">ç¢ºèªçµå–®</button>
        <button id="resetBtn" class="btn-checkout hidden" style="background:#f39c12;" onclick="resetAndBack()">è¿”å›æ¸…ç©º</button>
        <button class="btn-checkout" style="background:#3498db;" onclick="window.print()">åˆ—å°å–®æ“š</button>
    </div>
</div>

<script>
    const TAI_TO_CM = 30.3;
    const TAI_TO_INCH = 11.93;
    let cart = [];
    let livePrice = 0;

    function initDates() {
        const today = new Date();
        const future = new Date(); future.setDate(today.getDate() + 14);
        document.getElementById('date_receive').value = today.toISOString().split('T')[0];
        document.getElementById('date_deliver').value = future.toISOString().split('T')[0];
    }

    function calculateLive() {
        const mode = document.getElementById('mode').value;
        const warningEl = document.getElementById('liveWarning');
        warningEl.innerText = "";
        
        const Lt = (parseFloat(document.getElementById('L_input').value) || 0) / 100;
        const Wt = (parseFloat(document.getElementById('W_input').value) || 0) / 100;
        const pLt = (parseFloat(document.getElementById('padL_input').value) || 0) / 100;
        const pWt = (parseFloat(document.getElementById('padW_input').value) || 0) / 100;
        
        if (Lt <= 0 || Wt <= 0) { livePrice = 0; document.getElementById('liveTotal').innerText = "0"; return; }

        const tL = Lt + pLt; const tW = Wt + pWt;
        const inLcm = tL * TAI_TO_CM; const inWcm = tW * TAI_TO_CM;
        const L_inch = tL * TAI_TO_INCH; const W_inch = tW * TAI_TO_INCH;
        const totalCai = (L_inch * W_inch) / 144;

        document.getElementById('innerL_txt').innerText = inLcm.toFixed(1);
        document.getElementById('innerW_txt').innerText = inWcm.toFixed(1);
        document.getElementById('innerTai_txt').innerText = `${tL.toFixed(2)}x${tW.toFixed(2)}`;

        if (mode === 'oil') {
            document.getElementById('oilDetail').style.display = "block";
            document.getElementById('inch_txt').innerText = `${L_inch.toFixed(1)}" x ${W_inch.toFixed(1)}"`;
            
            const oilType = document.getElementById('oilType').value;
            const frameBase = parseInt(document.getElementById('oilFrameBase').value);
            
            // åŸºç¤åˆ¤å®š
            let multiplier = (inLcm > 120 || (inLcm + inWcm)*2 > 480) ? 1.8 : 1.0;
            if (multiplier > 1) warningEl.innerText = "âš ï¸ ç‰¹å¤§å‹ä»¶å·²è¨ˆå…¥çµæ§‹æº¢åƒ¹";

            // A. åº•æ¿è²» (ç«‹é«”/å…§å¤–æ¡†)
            let basePrice = (oilType === 'direct') ? 0 : Math.round(totalCai * 50);
            // B. æ¡†æ¢è²» (è‹±å‹å‘¨é•·)
            let framePrice = Math.round((L_inch + W_inch) * frameBase * multiplier);
            // C. å…§æ¡†è²» (å…§å¤–æ¡†)
            let innerFramePrice = (oilType === 'inout') ? Math.round((L_inch + W_inch) * 12) : 0;
            
            livePrice = basePrice + framePrice + innerFramePrice;

            // é¸é…
            if (document.getElementById('oilCloth').checked) livePrice += Math.round((L_inch + W_inch) * 12);
            if (document.getElementById('oilAcy').checked) livePrice += Math.round(totalCai * 80);
            if (document.getElementById('oilSwap').checked) livePrice += Math.round(totalCai * 50);
            if (document.getElementById('oilProtect').checked) livePrice += Math.round(totalCai * 80);
            livePrice += (parseFloat(document.getElementById('oilRepair').value) || 0);

        } else if (mode === 'normal') {
            const baseRate = parseInt(document.getElementById('baseRate').value);
            let mult = (inLcm > 120 || (inLcm + inWcm)*2 > 480) ? 1.5 : 1.0;
            let extra = (inLcm > 120 || (inLcm + inWcm)*2 > 480) ? 4000 : 0;
            livePrice = Math.round((tL + tW) * baseRate * mult + extra);
        } else if (mode === 'board') {
            livePrice = Math.round(totalCai * 80);
        }

        if (livePrice > 0 && livePrice < 350) livePrice = 350;
        document.getElementById('liveTotal').innerText = livePrice.toLocaleString();
    }

    function toggleMode() {
        const mode = document.getElementById('mode').value;
        document.getElementById('oil-options').style.display = (mode === 'oil') ? 'block' : 'none';
        document.getElementById('normal-extra').style.display = (mode === 'normal') ? 'block' : 'none';
        document.getElementById('scroll-inputs').style.display = (mode === 'scroll') ? 'block' : 'none';
        calculateLive();
    }

    function addToCart() {
        if (livePrice <= 0) return alert("è«‹è¼¸å…¥å°ºå¯¸");
        const mode = document.getElementById('mode').value;
        let title = "æ²¹ç•«è£æ¡†";
        if (mode === 'oil') {
            const typeText = document.getElementById('oilType').options[document.getElementById('oilType').selectedIndex].text;
            const frameText = document.getElementById('oilFrameBase').options[document.getElementById('oilFrameBase').selectedIndex].text;
            title = `æ²¹ç•«-${typeText}(${frameText})`;
        } else if (mode === 'normal') {
            title = document.getElementById('baseRate').options[document.getElementById('baseRate').selectedIndex].text;
        } else if (mode === 'board') { title = "åœ‹ç•«è£±æ¿"; }
        
        cart.push({ title, price: livePrice, spec: `å°ºå¯¸ï¼š${document.getElementById('innerTai_txt').innerText}å°º` });
        renderCart();
    }

    function renderCart() {
        const tbody = document.getElementById('cartItems'); tbody.innerHTML = ""; let total = 0;
        cart.forEach((item, index) => {
            total += item.price;
            tbody.innerHTML += `<tr><td style="padding:8px; border-bottom:1px solid #eee;"><b>${item.title}</b><br><small>${item.spec}</small></td><td style="padding:8px; border-bottom:1px solid #eee;">${item.price.toLocaleString()}</td><td class="no-print" style="padding:8px; border-bottom:1px solid #eee;"><button onclick="cart.splice(${index},1);renderCart();" style="background:none;border:none;color:red;cursor:pointer;">âŒ</button></td></tr>`;
        });
        document.getElementById('grandTotal').innerText = total.toLocaleString();
    }

    function checkoutMode() {
        if (cart.length === 0) return alert("æ¸…å–®ç‚ºç©º");
        document.getElementById('p_name').innerText = document.getElementById('cust_name').value || "æœªå¡«";
        document.getElementById('p_phone').innerText = document.getElementById('cust_phone').value || "æœªå¡«";
        document.getElementById('p_dateR').innerText = document.getElementById('date_receive').value;
        document.getElementById('p_dateD').innerText = document.getElementById('date_deliver').value;
        document.getElementById('inputSection').classList.add('hidden');
        document.getElementById('confirmBtn').classList.add('hidden');
        document.getElementById('resetBtn').classList.remove('hidden');
    }

    function resetAndBack() {
        if (!confirm("ç¢ºå®šé‡ç½®ï¼Ÿ")) return;
        cart = []; renderCart();
        document.getElementById('inputSection').classList.remove('hidden');
        document.getElementById('confirmBtn').classList.remove('hidden');
        document.getElementById('resetBtn').classList.add('hidden');
        initDates();
    }

    window.onload = function() { initDates(); toggleMode(); };
</script>
</body>
</html>