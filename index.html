<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŸ‹ç‘ç•«å»Š v7.2</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 550px; margin-bottom: 15px; box-sizing: border-box; }
        h2, h3 { text-align: center; color: #2c3e50; margin-top: 0; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .section { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #34495e; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccd1d9; border-radius: 8px; box-sizing: border-box; font-size: 16px; background: #fff; }
        .row { display: flex; gap: 8px; align-items: center; }
        .unit-info { font-size: 14px; color: #2980b9; margin-top: 12px; background: #eef7ff; padding: 12px; border-radius: 8px; border: 1px solid #d6eaf8; line-height: 1.6; }
        .live-price-box { background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 2px dashed #e67e22; margin: 10px 0; }
        .live-price-val { font-size: 32px; font-weight: bold; color: #e67e22; }
        .btn-add { background: #27ae60; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn-checkout { background: #2c3e50; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .inv-panel { background: #2c3e50; color: white; padding: 15px; border-radius: 15px; width: 100%; max-width: 550px; margin-top: 20px; }
        .option-group { background:#fff9f0; padding:12px; border-radius:10px; border: 1px solid #ffe0b2; margin-top: 10px; }
        .check-item { display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 8px; font-size: 14px; }
        .check-item input { width: auto; transform: scale(1.2); }
        .hidden { display: none !important; }
        @media print { .no-print { display: none !important; } .card { box-shadow: none; border: none; width: 100%; } body { background: #fff; padding: 0; } }
    </style>
</head>
<body>

<div class="card no-print">
    <h2>éŸ‹ç‘ç•«å»Š v7.2</h2>
    <div class="section" style="background: #fcfcfc; border: 1px solid #eee; padding: 15px; border-radius: 10px;">
        <label>ğŸ‘¤ å®¢æˆ¶åŸºæœ¬è³‡æ–™</label>
        <div class="row" style="margin-bottom: 10px;">
            <input type="text" id="cust_name" placeholder="å®¢æˆ¶å§“å">
            <input type="tel" id="cust_phone" placeholder="è¯çµ¡é›»è©±">
        </div>
        <div class="row">
            <div style="flex:1;"><label style="font-size:12px;">æ”¶ä»¶æ—¥æœŸ</label><input type="date" id="date_receive"></div>
            <div style="flex:1;"><label style="font-size:12px;">é è¨ˆäº¤ä»¶</label><input type="date" id="date_deliver"></div>
        </div>
    </div>
</div>

<div class="card no-print" id="inputSection">
    <h3>ğŸ’° å ±åƒ¹è¨ˆç®—</h3>
    <div class="section">
        <label>å ±åƒ¹æ¨¡å¼</label>
        <select id="mode" onchange="toggleMode()">
            <option value="normal" selected>åœ‹ç•«è£æ¡† (å‘¨é•·è¨ˆåƒ¹)</option>
            <option value="oil">æ²¹ç•«è£æ¡† (å †ç–Šè¨ˆåƒ¹)</option>
            <option value="board">åœ‹ç•«è£±æ¿ (é¢ç©è¨ˆåƒ¹)</option>
            <option value="scroll">ç«‹è»¸æ›è»¸</option>
        </select>
    </div>

    <div class="row">
        <div style="flex:1;"><label>ç•«å¿ƒé•· (ä¸‰ä½æ•¸)</label><input type="number" id="L_in" oninput="runCalc()" inputmode="numeric" placeholder="å¦‚ 300"></div>
        <div style="flex:1;"><label>ç•«å¿ƒå¯¬ (ä¸‰ä½æ•¸)</label><input type="number" id="W_in" oninput="runCalc()" inputmode="numeric" placeholder="å¦‚ 600"></div>
    </div>
    <div class="row" style="margin-top:10px;">
        <div style="flex:1;"><label>é ç•™é•·é‚Š</label><input type="number" id="padL" value="100" oninput="runCalc()"></div>
        <div style="flex:1;"><label>é ç•™çŸ­é‚Š</label><input type="number" id="padW" value="50" oninput="runCalc()"></div>
    </div>

    <div id="normal-options" class="option-group">
        <label>é¸æ“‡æ¡†ç¨® (æ¯å°ºåŸºæ•¸)</label>
        <select id="baseRate" onchange="runCalc()">
            <option value="250">åœ‹ç•«æ¡† (250)</option>
            <option value="280">2å¯¸ç‰¹é¸æ‰‹å·¥æ¡† (280)</option>
            <option value="300">3å¯¸ç‰¹é¸æ‰‹å·¥æ¡† (300)</option>
            <option value="230">8åˆ†ç‰¹é¸æ‰‹å·¥æ¡† (230)</option>
            <option value="200">6åˆ†ç‰¹é¸æ‰‹å·¥æ¡† (200)</option>
        </select>
        <div class="check-item" style="margin-top:10px;"><input type="checkbox" id="addAcy" onchange="runCalc()"> åŠ å£“å…‹åŠ› (120/æ‰)</div>
    </div>

    <div id="oil-options" class="option-group hidden">
        <label>æ²¹ç•«æ–½ä½œæ–¹å¼</label>
        <select id="oilType" onchange="runCalc()">
            <option value="direct">ç›´æ¥æ¡† (å–®ç´”æ¡†æ¢)</option>
            <option value="solid">ç«‹é«”æ¡† (åº•æ¿ + æ¡†æ¢)</option>
            <option value="inout">å…§å¤–æ¡† (åº•æ¿ + æ¡†æ¢ + å…§æ¡†)</option>
        </select>
        <label style="margin-top:10px;">æ¡†æ¢é¸æ“‡</label>
        <select id="oilFrameBase" onchange="runCalc()">
            <option value="20">6åˆ†æ¡† (20)</option>
            <option value="25">å¯¸åŠæ¡† (25)</option>
            <option value="35">å…©å¯¸åŠæ¡† (35)</option>
            <option value="45">ä¸‰å¯¸æ¡† (45)</option>
        </select>
        <div class="check-item" style="margin-top:10px;"><input type="checkbox" id="oilCloth" onchange="runCalc()"> åŠ å¸ƒå…§æ¡† (é•·+å¯¬ x 12)</div>
        <div class="check-item"><input type="checkbox" id="oilAcy" onchange="runCalc()"> åŠ å£“å…‹åŠ› (80/æ‰)</div>
        <div class="check-item"><input type="checkbox" id="oilProtect" onchange="runCalc()"> ç•«é¢ä¿è­· (80/æ‰)</div>
    </div>

    <div id="board-options" class="option-group hidden">
        <label>åŠ è³¼ Lå‹æ¡†</label>
        <select id="lFrameType" onchange="runCalc()">
            <option value="0">ç„¡åŠ æ¡†</option>
            <option value="12">Lå‹æ¡† - ä¾¿æ¡† (åŸºæ•¸ 12)</option>
            <option value="25">Lå‹æ¡† - æ‰‹å·¥æ¡† (åŸºæ•¸ 25)</option>
        </select>
    </div>

    <div id="scroll-options" class="option-group hidden">
        <label>ç«‹è»¸è¦æ ¼</label>
        <select id="scrollSize" onchange="runCalc()">
            <option value="1000">å°å°é–‹ (1000)</option>
            <option value="900">å°é–‹ (900)</option>
            <option value="1300">ä¸‰é–‹ (1300)</option>
            <option value="1500">å…¨é–‹ (1500)</option>
            <option value="3500">å¤§å…¨é–‹ (3500)</option>
        </select>
    </div>

    <div class="live-price-box">
        <div class="live-price-val">NT$ <span id="priceTxt">0</span></div>
        <div id="sizeDetail" class="unit-info"></div>
    </div>
    <button class="btn-add" onclick="addItem()">ï¼‹ åŠ å…¥è¨‚å–®æ¸…å–®</button>
</div>

<div class="card" id="cartSection">
    <h3>ğŸ“ å ±åƒ¹æ¸…å–®</h3>
    <div id="printInfo" class="hidden" style="border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:10px; font-size:14px;"></div>
    <table style="width:100%; border-collapse: collapse;" id="cartTable"></table>
    <div style="text-align:right; font-size:22px; font-weight:bold; color:#c0392b; margin-top:15px; border-top:2px solid #2c3e50; padding-top:10px;">
        ç¸½è¨ˆé‡‘é¡ï¼šNT$ <span id="totalTxt">0</span>
    </div>
    <div class="no-print">
        <button id="finalBtn" class="btn-checkout" onclick="processCheckout()">ç¢ºèªçµå–®</button>
        <button id="resetBtn" class="btn-checkout hidden" style="background:#f39c12;" onclick="location.reload()">ä¸‹ä¸€å¼µæ–°è¨‚å–®</button>
        <button class="btn-checkout" style="background:#3498db;" onclick="window.print()">åˆ—å°å–®æ“š</button>
    </div>
</div>

<div class="inv-panel no-print">
    <h3>ğŸ“¦ åº«å­˜å„€è¡¨æ¿ (ç¨ç«‹è¨˜éŒ„)</h3>
    <div id="invList"></div>
    <div style="margin-top:10px; border-top:1px solid #555; padding-top:10px; display:flex; gap:5px;">
        <select id="addType" style="background:#34495e; color:white; border:none; flex:1; padding:5px;">
            <option value="f1">1å¯¸2åœ‹ç•«æ¡†</option>
            <option value="f2">å°æ–°B1</option>
            <option value="a36">3X6å£“å…‹åŠ›</option>
            <option value="a48">4X8å£“å…‹åŠ›</option>
        </select>
        <input type="number" id="addQty" placeholder="æ•¸é‡" style="width:70px; padding:5px;">
        <button onclick="handleRestock()" style="background:#27ae60; color:white; border:none; padding:5px 10px; border-radius:5px;">é€²è²¨</button>
    </div>
</div>

<script>
    const TAI_TO_CM = 30.3;
    const TAI_TO_INCH = 11.93;
    let cart = [];
    let currentPrice = 0;

    // åº«å­˜æ•¸æ“š
    let inv = JSON.parse(localStorage.getItem('weray_standalone_inv')) || {
        f1: { name: "1å¯¸2åœ‹ç•«æ¡†", qty: 0, unit: "å°º" },
        f2: { name: "å°æ–°ï¼¢1", qty: 0, unit: "å°º" },
        a36: { name: "å£“å…‹åŠ› 3X6", qty: 0, unit: "å¼µ" },
        a48: { name: "å£“å…‹åŠ› 4X8", qty: 0, unit: "å¼µ" }
    };

    function runCalc() {
        const mode = document.getElementById('mode').value;
        const L = (parseFloat(document.getElementById('L_in').value) || 0) / 100;
        const W = (parseFloat(document.getElementById('W_in').value) || 0) / 100;
        const pL = (parseFloat(document.getElementById('padL').value) || 0) / 100;
        const pW = (parseFloat(document.getElementById('padW').value) || 0) / 100;
        
        if (L <= 0 || W <= 0) { currentPrice = 0; document.getElementById('priceTxt').innerText="0"; return; }

        const tL = L + pL; const tW = W + pW;
        const Lcm = tL * TAI_TO_CM; const Wcm = tW * TAI_TO_CM;
        const Linch = tL * TAI_TO_INCH; const Winch = tW * TAI_TO_INCH;
        const cai = (Linch * Winch) / 144;
        const perim_cm = (Lcm + Wcm) * 2;

        document.getElementById('sizeDetail').innerText = `æ¡†å…§ï¼š${Lcm.toFixed(1)}x${Wcm.toFixed(1)} cm (${tL.toFixed(2)}x${tW.toFixed(2)} å°º)`;

        if (mode === 'normal') {
            const base = parseInt(document.getElementById('baseRate').value);
            let mult = (Math.max(Lcm, Wcm) > 120 || perim_cm > 480) ? 1.5 : 1.0;
            let extra = (perim_cm >= 700) ? 5000 : ((perim_cm > 480) ? 3000 : 0);
            currentPrice = Math.round((tL + tW) * base * mult + extra);
            if(document.getElementById('addAcy').checked) currentPrice += Math.round(tL * tW * (mult > 1 ? 120 : 80));
        } else if (mode === 'oil') {
            const type = document.getElementById('oilType').value;
            const base = parseInt(document.getElementById('oilFrameBase').value);
            let mult = (Lcm > 120 || perim_cm > 480) ? 1.8 : 1.0;
            let baseP = (type === 'direct') ? 0 : Math.round(cai * 50);
            let frameP = Math.round((Linch + Winch) * base * mult);
            let inP = (type === 'inout') ? Math.round((Linch + Winch) * 12) : 0;
            currentPrice = baseP + frameP + inP;
            if(document.getElementById('oilCloth').checked) currentPrice += Math.round((Linch + Winch) * 12);
            if(document.getElementById('oilAcy').checked) currentPrice += Math.round(cai * 80);
            if(document.getElementById('oilProtect').checked) currentPrice += Math.round(cai * 80);
        } else if (mode === 'board') {
            const lRate = parseInt(document.getElementById('lFrameType').value);
            currentPrice = Math.round(cai * 80) + Math.round((Linch + Winch) * lRate);
        } else {
            currentPrice = parseInt(document.getElementById('scrollSize').value);
        }

        if(currentPrice < 350) currentPrice = 350;
        document.getElementById('priceTxt').innerText = currentPrice.toLocaleString();
    }

    function toggleMode() {
        const m = document.getElementById('mode').value;
        document.getElementById('normal-options').classList.toggle('hidden', m !== 'normal');
        document.getElementById('oil-options').classList.toggle('hidden', m !== 'oil');
        document.getElementById('board-options').classList.toggle('hidden', m !== 'board');
        document.getElementById('scroll-options').classList.toggle('hidden', m !== 'scroll');
        runCalc();
    }

    function addItem() {
        if(currentPrice <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆå°ºå¯¸");
        const mName = document.getElementById('mode').options[document.getElementById('mode').selectedIndex].text;
        cart.push({ title: mName, price: currentPrice, spec: document.getElementById('sizeDetail').innerText });
        renderCart();
    }

    function renderCart() {
        const table = document.getElementById('cartTable');
        table.innerHTML = ""; let total = 0;
        cart.forEach((it, idx) => {
            total += it.price;
            table.innerHTML += `<tr><td style="padding:10px; border-bottom:1px solid #eee;"><b>${it.title}</b><br><small>${it.spec}</small></td><td align="right" style="padding:10px;">${it.price.toLocaleString()}</td><td align="right" class="no-print"><button onclick="cart.splice(${idx},1);renderCart();" style="color:red; background:none; border:none; cursor:pointer; font-size:18px;">âŒ</button></td></tr>`;
        });
        document.getElementById('totalTxt').innerText = total.toLocaleString();
    }

    function processCheckout() {
        if(cart.length === 0) return alert("æ¸…å–®ç‚ºç©º");
        const name = document.getElementById('cust_name').value || "æœªå¡«";
        const phone = document.getElementById('cust_phone').value || "æœªå¡«";
        document.getElementById('printInfo').innerHTML = `<b>å®¢æˆ¶å§“åï¼š</b>${name} | <b>è¯çµ¡é›»è©±ï¼š</b>${phone}<br><b>æ”¶ä»¶æ—¥æœŸï¼š</b>${document.getElementById('date_receive').value} | <b>äº¤ä»¶æ—¥æœŸï¼š</b>${document.getElementById('date_deliver').value}`;
        document.getElementById('printInfo').classList.remove('hidden');
        document.getElementById('finalBtn').classList.add('hidden');
        document.getElementById('resetBtn').classList.remove('hidden');
        window.scrollTo(0,0);
    }

    function handleRestock() {
        const k = document.getElementById('addType').value;
        const v = parseFloat(document.getElementById('addQty').value) || 0;
        inv[k].qty += v;
        localStorage.setItem('weray_standalone_inv', JSON.stringify(inv));
        renderInv();
    }

    function renderInv() {
        const div = document.getElementById('invList');
        div.innerHTML = "";
        for(let k in inv) {
            div.innerHTML += `<div style="display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid #444;"><span>${inv[k].name}</span><span>${inv[k].qty.toFixed(1)} ${inv[k].unit}</span></div>`;
        }
    }

    window.onload = function() {
        const d = new Date();
        document.getElementById('date_receive').value = d.toISOString().split('T')[0];
        const next = new Date(); next.setDate(d.getDate() + 14);
        document.getElementById('date_deliver').value = next.toISOString().split('T')[0];
        renderInv(); runCalc();
    };
</script>
</body>
</html>
